## I. Topologie réseau

**☀️ Sur node1.lan1.tp2**
```
[nanouche@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:1b:3f:2b brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe1b:3f2b/64 scope link
       valid_lft forever preferred_lft forever

[nanouche@node1 ~]$ ip route show
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3 proto static metric 100

[nanouche@node1 ~]$ ping 10.1.2.12
PING 10.1.2.12 (10.1.2.12) 56(84) bytes of data.
64 bytes from 10.1.2.12: icmp_seq=1 ttl=63 time=1.24 ms
64 bytes from 10.1.2.12: icmp_seq=2 ttl=63 time=1.10 ms
64 bytes from 10.1.2.12: icmp_seq=3 ttl=63 time=1.11 ms
^C
--- 10.1.2.12 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2005ms
rtt min/avg/max/mdev = 1.100/1.148/1.240/0.064 ms

[nanouche@node1 ~]$ traceroute 10.1.2.12
traceroute to 10.1.2.12 (10.1.2.12), 30 hops max, 60 byte packets
 1  10.1.1.254 (10.1.1.254)  4.646 ms  4.122 ms  3.882 ms
 2  10.1.2.12 (10.1.2.12)  3.370 ms !X  3.176 ms !X  3.012 ms !X
```
## II. Interlude accès internet

**☀️ Sur router.tp2**
```
[nanouche@router ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=113 time=20.9 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=113 time=27.4 ms
^C
--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1003ms
rtt min/avg/max/mdev = 20.892/24.162/27.433/3.270 ms

[nanouche@router ~]$ ping ynov.com
PING ynov.com (104.26.11.233) 56(84) bytes of data.
64 bytes from 104.26.11.233 (104.26.11.233): icmp_seq=1 ttl=54 time=51.8 ms
^C64 bytes from 104.26.11.233: icmp_seq=2 ttl=54 time=20.1 ms

--- ynov.com ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 20.132/35.979/51.827/15.847 ms
```
**☀️ Accès internet LAN1 et LAN2**
```
[nanouche@node2 ~]$ ip r s
default via 10.1.1.254 dev enp0s3 proto static metric 100
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.12 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3 proto static metric 100
[nanouche@node2 ~]$

[nanouche@node2 ~]$ cat /etc/resolv.conf
# Generated by NetworkManager
search lan1.tp2
nameserver 1.1.1.1

[nanouche@node2 ~]$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=112 time=21.0 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=112 time=36.6 ms
^C
--- 8.8.8.8 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1002ms
rtt min/avg/max/mdev = 20.962/28.771/36.580/7.809 ms

[nanouche@node2 ~]$ ping ynov.com
PING ynov.com (172.67.74.226) 56(84) bytes of data.
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=1 ttl=53 time=20.4 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=2 ttl=53 time=39.1 ms
64 bytes from 172.67.74.226 (172.67.74.226): icmp_seq=3 ttl=53 time=68.2 ms
^C
--- ynov.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2003ms
rtt min/avg/max/mdev = 20.416/42.593/68.231/19.673 ms
```
## III. Services réseau
**☀️ Sur web.lan2.tp2**
```
[nanouche@node2 ~]$ sudo hostnamectl set-hostname web.lan2.tp2

[nanouche@web ~]$ sudo dnf install nginx -y

[nanouche@web ~]$ sudo mkdir -p /var/www/site_nul

[nanouche@web ~]$ sudo chown -R nginx:nginx /var/www/site_nul

[nanouche@web ~]$ sudo chmod -R 755 /var/www/site_nul

[nanouche@web ~]$ sudo cat /var/www/site_nul/index.html
<html>
  <head><title>Mon site nul</title></head>
  <body><h1>Bienvenue sur mon site nul !</h1></body>
</html>

[nanouche@web ~]$ sudo cat /var/www/site_nul/site.conf
server {
    listen 80;
    server_name web.lan2.tp2;

    root /var/www/site_nul;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }
}

[nanouche@web nginx]$ sudo firewall-cmd --add-port=80/tcp --permanent
success

[nanouche@web nginx]$ sudo firewall-cmd --reload
success

[nanouche@web nginx]$ sudo ss -tulnp | grep :80
tcp   LISTEN 0      511          0.0.0.0:80        0.0.0.0:*    users:(("nginx",pid=1522,fd=6),("nginx",pid=1521,fd=6))

[nanouche@web nginx]$ sudo firewall-cmd --list-all
public (active)
  target: default
  icmp-block-inversion: no
  interfaces: enp0s3
  sources:
  services: cockpit dhcpv6-client ssh
  ports: 80/tcp
  protocols:
  forward: yes
  masquerade: no
  forward-ports:
  source-ports:
  icmp-blocks:
  rich rules:
```
**☀️ Sur node1.lan1.tp2**
```
[nanouche@node1 ~]$ sudo cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.1.2.12 site_nul.tp2

[nanouche@node1 ~]$ curl http://site_nul.tp2
<html>
  <head><title>Mon site nul</title></head>
  <body><h1>Bienvenue sur mon site nul !</h1></body>
</html>
```
## 2. Or is it ? Bonus : DHCP
**☀️ Sur dhcp.lan1.tp2**
```
[nanouche@node2 ~]$ sudo hostnamectl set-hostname dhcp.lan1.tp2

[nanouche@dhcp ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:9c:53:ac brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.253/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe9c:53ac/64 scope link
       valid_lft forever preferred_lft forever

[nanouche@dhcp ~]$ dnf -y install dhcp-server
[nanouche@dhcp ~]$ sudo cat /etc/dhcp/dhcpd.conf
#
# DHCP Server Configuration file.
#   see /usr/share/doc/dhcp-server/dhcpd.conf.example
#   see dhcpd.conf(5) man page
#
# Option pour indiquer le domaine
option domain-name "lan1.tp2";
option domain-name-servers 1.1.1.1;  # Serveur DNS

# Option pour indiquer la passerelle
option routers 10.1.1.254;  # Passerelle

# Plage d'adresses IP à attribuer
subnet 10.1.1.0 netmask 255.255.255.0 {
    range 10.1.1.100 10.1.1.200;  # Plage d'adresses IP
    option subnet-mask 255.255.255.0;  # Masque de sous-réseau
}

[nanouche@dhcp ~]$ sudo firewall-cmd --add-service=dhcp
success
[nanouche@dhcp ~]$ sudo firewall-cmd --runtime-to-permanent
success

[nanouche@dhcp ~]$ sudo systemctl start dhcpd
[nanouche@dhcp ~]$ sudo systemctl status dhcpd
● dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; disabled; preset: disabled)
     Active: active (running) since Fri 2024-10-04 16:20:49 CEST; 1min 9s ago
       Docs: man:dhcpd(8)
             man:dhcpd.conf(5)
   Main PID: 1226 (dhcpd)
     Status: "Dispatching packets..."
      Tasks: 1 (limit: 20396)
     Memory: 7.1M
        CPU: 8ms
     CGroup: /system.slice/dhcpd.service
             └─1226 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Config file: /etc/dhcp/dhcpd.conf
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Database file: /var/lib/dhcpd/dhcpd.leases
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: PID file: /var/run/dhcpd.pid
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Source compiled to use binary-leases
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Wrote 0 leases to leases file.
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Listening on LPF/enp0s3/08:00:27:9c:53:ac/10.1.1.0/24
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Sending on   LPF/enp0s3/08:00:27:9c:53:ac/10.1.1.0/24
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Sending on   Socket/fallback/fallback-net
Oct 04 16:20:49 dhcp.lan1.tp2 dhcpd[1226]: Server starting service.
Oct 04 16:20:49 dhcp.lan1.tp2 systemd[1]: Started DHCPv4 Server Daemon.
```
**☀️ Sur node1.lan1.tp2**
```
[nanouche@node1 ~]$ sudo dhclient -v
Internet Systems Consortium DHCP Client 4.4.2b1
Copyright 2004-2019 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/enp0s3/08:00:27:1b:3f:2b
Sending on   LPF/enp0s3/08:00:27:1b:3f:2b
Sending on   Socket/fallback
DHCPDISCOVER on enp0s3 to 255.255.255.255 port 67 interval 5 (xid=0x11e63434)
DHCPOFFER of 10.3.1.3 from 10.3.1.5
DHCPREQUEST for 10.3.1.3 on enp0s3 to 255.255.255.255 port 67 (xid=0x11e63434)
DHCPACK of 10.3.1.3 from 10.3.1.5 (xid=0x11e63434)
bound to 10.3.1.3 -- renewal in 234 seconds.

[nanouche@node1 ~]$ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:1b:3f:2b brd ff:ff:ff:ff:ff:ff
    inet 10.1.1.11/24 brd 10.1.1.255 scope global noprefixroute enp0s3
       valid_lft forever preferred_lft forever
    inet 10.3.1.3/24 brd 10.3.1.255 scope global dynamic enp0s3
       valid_lft 643sec preferred_lft 643sec
    inet6 fe80::a00:27ff:fe1b:3f2b/64 scope link
       valid_lft forever preferred_lft forever

[nanouche@node1 ~]$ ip route
default via 10.1.1.254 dev enp0s3 proto static metric 100
1.1.1.1 via 10.1.1.254 dev enp0s3 proto static metric 100
10.1.1.0/24 dev enp0s3 proto kernel scope link src 10.1.1.11 metric 100
10.1.2.0/24 via 10.1.1.254 dev enp0s3 proto static metric 100
10.3.1.0/24 dev enp0s3 proto kernel scope link src 10.3.1.3

[nanouche@node1 ~]$ ping 10.1.2.11
PING 10.1.2.11 (10.1.2.11) 56(84) bytes of data.
64 bytes from 10.1.2.11: icmp_seq=1 ttl=63 time=1.41 ms
64 bytes from 10.1.2.11: icmp_seq=2 ttl=63 time=1.32 ms
64 bytes from 10.1.2.11: icmp_seq=3 ttl=63 time=1.03 ms
^C
--- 10.1.2.11 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2006ms
rtt min/avg/max/mdev = 1.026/1.252/1.414/0.164 ms
```